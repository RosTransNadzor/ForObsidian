
- Классическая школа
	- В классической школе тестирования моки используются для совместных зависимостей
- Моки
	- Моки используются для эмулирования вызовов системы к ее зависимостям для <span style="color:#7EFFDB;font-weight:bold;">изменения состояния этой зависимости</span>
	- Эмулируют взаимодействия и проверяют их (не всегда)
- Стабы 
	- Эмулируют вызов к зависимости для получения <span style="color:#7EFFDB;font-weight:bold;">входных данных</span>
	- Только эмулируют,но не проверяют
- Проверка взаимодействия со стабами
	- <span style="color:#FF2400;font-weight:bold;">Не стоит проверять взаимодействие со стабами</span> - их главная задача вернуть реультат
	- В то время как задача мока вызвать побочный эффект
- 2 сразу
	- Заглушка может одновременно являться и моком и стабом(1 метод вызывает побочный эффект, другой возвращает значение)
	- Эта заглушка все равно будет считаться моком
- Принцип CQS (Command Query Separation)
	- Каждый метод должен быть либо запросом,либо коммандой
	- Комманды - методы с побочными эффектами (Моки)
	- Запрос - метод возвращающий значение без побочных эффектов (Стабы)
- Проектирование API 
	- В хорошо спроектированном API наблюдаемое поведение совпадает с публичным API тогда как все детали имплементации скрываются
	- Если количество операций, которые должны быть вызваны клиентом для достижения одной цели больше 1, то в классе скорее всего происходит утечка имплементации
- Нарушение инвариантов
	- Инвариант - условие, должно поддерживаться постоянно.
	- При утечке имплементации нарушается инвариант системы и она рушится
	- В этом помагает инкапсуляция - помогает скрыть ненужные детали имплементации , которые потребителю типа не нужно держать в голове
	- При создании закрытого API тесты не смогут проверять детали имплементации, а сосредоточатся на проверке наблюдаемого поведения

<span style="color:HotPink;font-weight:bold;">Гексональная архитектура</span>

- Типичное приложение состоит из 2 слоев
	- 1) предметной области (domain layer)
	- 2) сервисов приложения
	- Эти 2 слоя составляют гексагон
- Слой предметной области
	- Функциональность ради которой строится приложение
	- Отвечае только за бизнес логику
	- Его классы не должны ничего знать о слое сервисов и о внешнем мире
- Слой сервисов 
	- Располагается поверх предменой области
	- Он координирует его взаимодействие со внешнем миром
	- Не должен содержать никакой бизнес логики
- Набор взаимодействующих приложений
	- Другие приложения взаимодействуют только со слоем сервисов 
	- ![[гекс.png|300]]
- Тесты слоев
	- Тесты предметной области - проверяют только бизнес логику
	- Однако тесты сервисов - проверяют бизнес сценарий в целом

<span style="color:HotPink;font-weight:bold;">Внутренние и межсистемные взаимодействия</span>

- Внутренние взаимодействия 
	- Это взаимодействия между классами внутри приложения
- Межсистемные взаимодействия
	- Это взаимодействие с внешнем приложением
- Неизменность взаимодействий
	- Независимо от того , сколько рефакторинга делается внутри системы, взаимодействия этой системы с внешними приложениями должны оставаться неизменными
- Моки 
	- Они эффективны только при проверке взаимодействий между системой и внешнем приложением
	 - Если проверять взаимодействие внутри системы - это приведет к хрупким тестам
- Внепроцессная зависимость
	- Если внепроцессная зависимость доступна только через ваше приложение, по сути явяется частью вашего приложения
	- Взаимодействия с ней должны применяться с использованием моков
- 