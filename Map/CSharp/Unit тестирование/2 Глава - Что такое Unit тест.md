[[Unit Тестирование]]

- Лондонская школа и изоляция тестов
	- Лондоская школа утверждает, что все зависимости типов должны быть заменены тестовыми загрушками
	- При падении теста точно можно знать причину
- Классическая школа
	- В классической школе изолируются не сами тесты а не система от зависимостей
- Фазы в Unit тестах 
	- 1 Arrange - подготовка
	- 2 Action - выполнение действий 
	- 3 Assert - проверка результатов тестов
- Что такое SUT?
	- System under test - тестируемая система
- Что такое коллаборант?
	- Коллаборатор (collaborator) — это изменяемая зависимость
- Что такое Mock
	- Особая разновидность тестовой заглушки,которая позволяет проанализировать взаимодействия между тестируемой системой и ее коллаборантами
- Библиотека для создание моков
	- Moq - для C#
	- Пример кода на Moq 
		```cs
		Mock<IStore> storeMock = new();  
		storeMock.Setup(x => x.HasEnoughInventory(Product.Shampoo,5))  
		    .Returns(false);  
		  
		storeMock.Setup(x => x.RemoveInventory(Product.Shampoo,5))  
		    .Returns(true);  
		  
		Customer customer = new();  
		//Act bool success = customer.Purchase(  
		    storeMock.Object,Product.Shampoo,5  
		);  
		  
		//Assert  
		Assert.False(success);  
		//сколько раз был вызван метод RemoveInventory в процессе теста
		storeMock.Verify(  
		    x => x.RemoveInventory(Product.Shampoo,5),  
		    Times.Never  
		);
		```

<span style="color:HotPink;font-weight:bold;">Типы зависимостей</span>

- Совместное состояние
	 - Совместное состояние - состояние которое влиет на другие тесты и это плохо
- Совместные зависимости (shared)
	- Зависимость к которой имеют доступ несколько тестов и влияют друг на друга
	- Например База Данных
- Внепроцессная зависимость (out of process)
	- Зависимость работающая вне процесса приложения
	- База данных используемая для чтения - несовместная внепроцессная зависимость
- Изолированность Тестов
	- Unit тест должен всегда изолироваться от любой совместной зависимости
- Нестабильная зависимость (volatile)
	- Зависимость поведение которой невозможно предопределить
	- Например генератор случайных чисел
- Различие в изолированности в разных школах тестирования
	- ![[изоляция.png]]

<span style="color:HotPink;font-weight:bold;">Тестирование</span>

- Что должны проверять Unit тесты?
	- Они должны проверять определенное единицу поведения, а не определенный тип
	- Тест может охватывать как несколько классов, так и только один класс или даже всего один маленький метод.
- Тестирование большого графа взаимосвязанных графов
	- В лондонской школе все зависимости заменяются на моки
	- В классической прийдется воссоздать весь сложный граф и заменить только совместные зависимости
	- <span style="color:#7EFFDB;font-weight:bold;">Хотя как правило, большой граф классов является результатом плохого проектирования кода</span>
- Выявление ошибки в тестах
	- В классической школе при ошибке падают не один а несколько зависимых тестов, в отличии от лондонской
	- Ошибку будет легко обнаружить если только регулярно не запускать тесты и понимать ,что ты недавно изменил
	- Падение многих тестов при изменении класса может показать его важность в системе (это плюс)

<span style="color:HotPink;font-weight:bold;">Интеграционные тесты</span>

- Что такое интеграционный тест
	- Если он <span style="color:#7EFFDB;font-weight:bold;">не</span> удовлетворяет следущим условиям
		- проверяет одну единицу поведения
		- делает это быстро
		- и в изоляции от других тестов
	 - Лучше всего использовать для проверки работы системы в целом или взаимодействия нескольких ее компонентов
	 - Тесты которые обращаются к базе данных интеграционные тк они нарушают изоляцию тестов
- Что такое сквозной тест
	- Тесты которые проверяют систему с точки зрения конечного пользователя
	- Они используют большую часть совместных зависимостей и ОЧЕНЬ редко заменяют их заглушками

