[[Entity Framework]]

- Пример проблемы параллелизма
- 2 контекст при обновлении базы данных имеет неверные исходные данные которые уже были обновлены

![[concurrent.png]]

- Поиск конфликтов
```cs
public class ConcurrencyBook { 
	public int ConcurrencyBookId { get; set; } 
	// в других случаях исключения не будет
	public string Title { get; set; } 
	// при возникновении вышеописанной проблемы возникнет исключение у 2 контекста у которого были устаревшие данные
	[ConcurrencyCheck] public DateTime PublishedOn { get; set; } 
	public ConcurrencyAuthor Author { get; set; } }
// или
modelBuilder.Entity().Property(p => p.PublishedOn).IsConcurrencyToken();
```
- Обнаружение для всей сущности(временная метка)
```cs
public class ConcurrencyAuthor {
	public int ConcurrencyAuthorId { get; set; }
	public string Name { get; set; }
	//временная метка - изменяется каждый раз при обновлении сущности
	[Timestamp] public byte[] ChangeCheck { get; set; } 
}
// или
modelBuilder.Entity() .Property(p => p.ChangeCheck).IsRowVersion();
```