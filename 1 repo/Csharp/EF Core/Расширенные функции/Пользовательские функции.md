[[Расширенные функции]]

- Выполняют вычисления в базе данных собственных функции
- Они выполняются только для ЗАПРОСОВ
- Чтобы ее описать нужно знать sql

- Описание
```cs
// в контексте - это всего лишь описание реализована она будет на sql
[DbFunction] public static double? AverageVotes(int id) { return null; }
```
- Функция с несколькими возвращающими значениями
```cs
public class TableFunctionOutput { 
	public string Title { get; set; } 
	public int ReviewsCount { get; set; } 
	public double? AverageVotes { get; set; }
}
// регистрация в контексте
public IQueryable GetBookTitleAndReviewsFiltered(int minReviews) {
	return FromExpression(() => GetBookTitleAndReviewsFiltered(minReviews));
}
protected override void OnModelCreating(ModelBuilder modelBuilder){
	//регистрация ответа
	modelBuilder.Entity() .HasNoKey();
	// ргистрация функции
	modelBuilder.HasDbFunction(() => GetBookTitleAndReviewsFiltered(default(int))); //… Другие конфигурации опущены; }
```
- Создание функции через sql
```sql
CREATE FUNCTION {UdfAverageVotes} (@bookId int)
" + @" 
RETURNS float AS BEGIN DECLARE @result AS float SELECT @result = AVG(CAST([NumStars] AS float)) 
FROM dbo.Review AS r WHERE @bookId = r.BookId RETURN @result END
```
- Неполная информация