[[Внедрение зависимостей]]

##### Это очень важная тема в этом разделе
###### !!! Сервис должен использовать только те зависимости, жизненный цикл которых превышает или эквивалентен жизненному циклу сервиса. Сервис, зарегистрированный как синглтон, может безопасно использовать только singleton- зависимости. Сервис, зарегистрированный как scoped, может безопасно использовать scoped- или singleton-зависимости - [[Решение проблемы жизненного цикла]]

- Пример - если у Repository цикл жизни scoped, то у DataContext может быть цикл либо scoped либо transient
```cs
public class Repository 
{ 
	private readonly DataContext _dataContext; 
	public Repository(DataContext dataContext) { _dataContext = dataContext; }
}
```
Три типа жизненных цикла
- Transient – каждый раз, когда запрашивается сервис, создается новый экземпляр. Это означает, что потенциально у вас могут быть разные экземпляры одного и того же класса в одном и том же графе зависимостей; 
- Scoped – в пределах области применения все запросы сервиса будут предоставлять вам один и тот же объект. Для разных областей вы получите разные объекты. В ASP.NET Core каждый веб-запрос получает свою область применения;
- Singleton – создается только один раз и повторно используется на протяжении всего срока службы приложения.
-----------------------------------------------------
- !!!!!  В ASP.NET Core область применения соответствует запросу
- Transient -  DataContext всегда будет заново создаваться
```cs
// 2 класса причем в Repository содержится еще один DataContext
services.AddTransient<DataContext>(); 
// В DataContext содержится рандомное число
//В Repository - число из DataContext
services.AddTransient<Repository>();
```
- Результаты  для Transient 
- В 2 запросах числа разные, причем даже в одном запросе DataContext
- и DataContext в Repository - разные объекты
![[transient.png]]

- Scoped - DataContext будет одним рамках одного запроса
```cs
services.AddScoped()
```
![[scoped.png]]

## !!! Singleton - один на все приложение
```cs
// !!!! сервисы одиночки должны быть потокобезопасными
services.AddSingleton();
```
![[singleton.png]]